## Тестовое задание в DataLouna.io

> _Для удобства разбил на два сервиса __`/service1`__ - выгрузка скинов, __`/service2`__ - сервис с покупкой и базой._

Запуск `docker compose up --build`.

Отдельный запуск __Redis__ в докере:

```bach
docker run -d --name redis -p 6379:6379 redis:alpine3.22
```

Отдельный запуск __Postgres__ в докере:

```bach
docker run --name test1 -p 5432:5432 -e POSTGRES_USER=root -e POSTGRES_PASSWORD=root -e POSTGRES_DB=test -d postgres
```

### /service1

> _Так как есть ограничение по запросам, и данные обновляются раз в 5 минут, я сделал преодический опрос с записью в кэш._

Запрос на получение скинов с ценами:

```bash
curl localhost:3001/skins
```

Вернет массив с объектами:

```typescript
interface SkinPrice {
  name: string
  min_price_tradable: number | null
  min_price_not_tradable: number | null
  created_at: number
}
```

### /service2

> _Схема и мок данных применяется через композ файл._

Таблицы:

```sql
CREATE TABLE users (
  id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name varchar,
  balance integer,
  created_at timestamp,
  updated_at timestamp
);

CREATE TABLE products (
  id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  price varchar,
  created_at timestamp,
  updated_at timestamp
);

CREATE TABLE purchases (
  id integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id integer REFERENCES users(id) ON DELETE RESTRICT ON UPDATE CASCADE,
  product_id integer REFERENCES products(id) ON DELETE RESTRICT ON UPDATE CASCADE,
  created_at timestamp,
);
```

Покупка товара:

```bash
curl localhost:3002/products/buy \
  --request POST \
  --data '{ "user_id": 1, "product_id": 1 }' \
  --header 'Content-Type: application/json'
```

Пример ответа:

```json
{ 
  "id": 1, 
  "name": "user1", 
  "balance": 802
}
```